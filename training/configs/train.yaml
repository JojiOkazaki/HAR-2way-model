logging:
  log_dir: runs
  best_model_name: best_model.pt
  csv_name: loss_history.csv
  graph_dir: graphs
  graph_size: [6, 4]

dataset:
  name: ucf101

data:
  processed_dir: processed
  split: split01
  # img_pt_dir: processed_112_32/pt
  # skel_pt_dir: processed_112_32/pt
  # train_file_list: processed_112_32/splits/default/train_list.txt
  # val_file_list: processed_112_32/splits/default/val_list.txt
  num_workers: 16

weighted_sampler:
  enabled: true
  alpha: 1.0

model:
  architecture:
    img:
      backbone: "custom" # custom/resnet18/resnet50
      cnn:
        conv_channels: [3, 16, 32, 62, 128, 256]
        fc_layers: [128]
        dropouts: [0.0, 0.1, 0.2, 0.4, 0.5]
        input_size: [112, 112]
      transformer:
        d_model: 128
        nhead: 8
        num_layers: 2
        dim_ff: 256
        max_len: 32
        dropout: 0.8

    skel:
      stgcn:
        channels: [3, 64, 64, 96] # 8/16/32/48/64/80/96
        dropouts: [0.0, 0.2, 0.3]
        temporal_kernel_size: 9
        norm: layer # batch / layer

    mlp:
      layers: [224, 512, 768]
      dropouts: [0.6]

  loss_weights: [0.0, 0.0, 1.0]

training:
  batch_size: 4
  epochs: 120
  accum_steps: 16
  max_norm: 1.0 # 勾配が大きすぎないようにする。小さいと学習が遅くなり安定する。
  seed: 42
  patience: 15
  min_delta: 0.005
  recall_k: 1
  
  # proto_ce で学習（(A)）
  loss_mode: proto_ce

  # proto作成用の走査バッチ（VRAM節約で train batch と分けたい場合）
  prototype_batch_size: 64

  # valid人物判定（Trainer側で使う）
  min_valid_t: 16

  # unknown扱いしたい label_id（例: 999 を学習対象から外す）
  unknown_label_ids: [999]

  # proto_ce でも温度は使う（logitsのスケーリング）
  temperature: 0.2

optimizer:
  lr: 0.0001 # 1e-3になると学習できない 0.0005 -> 0.001 (2倍)
  weight_decay: 0.05
  warmup_epochs: 3 # 学習の立ち上がりを遅くすることで序盤を安定させる。小さいと立ち上がりが速くなる。
  min_lr_ratio: 0.01 # 学習後半で学習率を小さくすることで振動を安定させる。小さいと最終学習率が小さくなる。

runtime:
  device: cuda

preprocess:
  img_aug:
    p: 0.8              # 適用確率
    jitter: 0.2         # 色調変化の強さ
    noise_std: 0.02     # ノイズ
    p_erasing: 0.3      # RandomErasing(一部隠し)の確率
  
  skel_aug:
    p: 0.5
    theta: 15
    scale: [0.9, 1.1]
    shift: 0.05